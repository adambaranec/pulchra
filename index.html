<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Live coding language for 3D visuals.">
    <meta name="keywords" content="Art, Digital art, 3d art, live coding, rendering, graphics">
    <link rel="stylesheet" href="index.css">
    <title>Pulchra</title>
</head>
<body>
<script type="module">
      import init, {start, set} from './pkg/pulchra.js';
      let canvas = document.getElementById('canvas');
      let input = document.getElementById('input');
      let audio;
      window.onload = (e) =>{
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      init()
      .then(()=>start())
      }
      window.onresize = (e) =>{
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      }
      function record(){
        let canvas_stream = canvas.captureStream(60);
        let recorder = new MediaRecorder(canvas_stream);
      }
      input.addEventListener('keydown', (e)=>{
        if (e.metaKey && e.key == 'Enter'){
          console.clear();
          if (typeof audio === 'undefined'){
            audio = new AudioContext();
           } else {
            audio.close();
            audio = new AudioContext();
           }
          if (input.value || input.value != ''){
            set(String(input.value),canvas.getContext('webgl2'),audio);
          } else {
            document.getElementById('error').innerHTML = '';
          }
          } 
          else if (e.ctrlKey && e.key == 'r'){
          //shows a dialog and starts recording
          }
          else if (e.ctrlKey && e.key == 's'){
          //stops and saves all recordings
          }
      });
</script>
<div id="pulchra">
  <div class="input-area">
    <textarea id="input" placeholder="Welcome to Pulchra!
Just press any key." autofocus="true" rows="8"></textarea>
  </div>
  <div class="background">
    <canvas id="canvas"></canvas>
  </div>
</div>
<div id="dialog">
  <div class="dialog-content">
    <div class="quit">
      <button>X</button>
    </div>
     <div class="dialog-question">
       <p><strong>What would you like to record?</strong></p>
     </div>
     <div class="dialog-options">
       <input type="checkbox" name="video" id="video">Video</input>
       <input type="checkbox" name="audio" id="audio">Audio</input>
     </div>
     <div class="dialog-submit">
      <input type="submit" value="Ok" onsubmit="record()"></input>
     </div>
  </div>
</div>
<footer><p id="error"></p></footer>
</body>
</html>